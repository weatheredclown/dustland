<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dustland Link Exchange</title>
  <link rel="stylesheet" href="./dustland.css">
  <style>
    body { max-width: 780px; margin: 40px auto; padding: 0 20px; font-family: 'Pixelify Sans', sans-serif; }
    h1, h2 { text-transform: uppercase; letter-spacing: 2px; }
    textarea { width: 100%; box-sizing: border-box; min-height: 80px; font-family: monospace; font-size: 0.8125rem; padding: 8px; }
    .row { margin-bottom: 24px; }
    .status { font-size: 0.875rem; color: #9ec2a4; margin-top: 8px; min-height: 20px; }
    .muted { color: #9ea5a1; font-size: 0.875rem; }
    .peer-list { font-size: 0.875rem; color: #d4f3d8; margin-top: 8px; }
    .section { border: 1px solid #2f3b2f; padding: 16px; border-radius: 6px; background: rgba(15, 24, 15, 0.6); margin-bottom: 20px; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    .controls .btn { flex: 0 0 auto; }
    label { display: block; font-weight: 600; margin: 16px 0 8px; }
    .hidden { display: none !important; }
    .flow { margin-top: 16px; }
    .invite-card { border: 1px solid #2f3b2f; padding: 12px; border-radius: 6px; background: rgba(12, 20, 12, 0.6); }
    .invite-card + .invite-card { margin-top: 16px; }
    .invite-card textarea { min-height: 72px; }
    .invite-card label { margin: 12px 0 6px; }
    .invite-card .status { margin-top: 8px; min-height: 20px; color: #9ec2a4; }
  </style>
</head>
<body>
  <h1>Dustland Multiplayer</h1>
  <p class="muted">Share codes with friends to sync a co-op session. Hosting works on GitHub Pagesâ€”no servers required. Keep this tab open while you play.</p>

  <section class="section" id="modeSection">
    <h2>Choose a Role</h2>
    <p class="muted">Dustland uses peer-to-peer links. Decide whether you're hosting or joining to walk through the setup.</p>
    <div class="controls">
      <button class="btn" id="chooseHost">Host a Game</button>
      <button class="btn" id="chooseJoin">Join a Game</button>
    </div>
  </section>

  <section class="section hidden" id="hostSection">
    <h2>Host a Session</h2>
    <p class="muted">We'll spin up a room and produce a host code. Share it with your friend, then paste their answer code to finish linking.</p>
    <div id="inviteControls" class="flow">
      <div class="controls">
        <button class="btn" id="newInvite" disabled>Generate Host Code</button>
      </div>
      <p class="muted">Each host code links one player. Generate invites ahead of time so everyone can join without waiting.</p>
    </div>
    <div id="inviteDeck" class="flow hidden">
      <p class="muted" id="inviteEmpty">No active invites yet. Generate a host code to begin.</p>
    </div>
    <template id="inviteTemplate">
      <div class="invite-card">
        <label>Host Code</label>
        <textarea class="host-code" readonly placeholder="Host code appears here"></textarea>
        <div class="controls">
          <button class="btn copy-host">Copy Host Code</button>
        </div>
        <label>Answer Code</label>
        <textarea class="answer-input" placeholder="Paste the answer code from your friend"></textarea>
        <div class="controls">
          <button class="btn link-player">Link Player</button>
        </div>
        <div class="status invite-status"></div>
      </div>
    </template>
    <div class="peer-list" id="peerList">No players linked yet.</div>
    <div class="status" id="hostStatus"></div>
  </section>

  <section class="section hidden" id="joinSection">
    <h2>Join a Session</h2>
    <p class="muted">Paste the host code from your friend. Once it's in place we'll walk you through generating the answer to send back.</p>
    <div id="joinCodeGroup" class="flow">
      <label for="joinCode">Host Code</label>
      <textarea id="joinCode" placeholder="Paste the host code"></textarea>
    </div>
    <div id="joinAnswerGroup" class="flow hidden">
      <div class="controls">
        <button class="btn" id="connectBtn" disabled>Generate Answer</button>
      </div>
      <label for="answerCode">Your Answer</label>
      <textarea id="answerCode" readonly placeholder="Answer code appears here"></textarea>
      <div class="controls">
        <button class="btn" id="copyAnswer" disabled>Copy Answer</button>
      </div>
    </div>
    <div class="status" id="joinStatus"></div>
  </section>

  <script defer src="./scripts/supporting/multiplayer-sync.js"></script>
  <script defer src="./scripts/multiplayer.js"></script>
  <script defer src="./scripts/supporting/multiplayer-lobby.js"></script>
</body>
</html>

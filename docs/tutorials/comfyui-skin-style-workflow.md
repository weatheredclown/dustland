# ComfyUI workflow for Dustland skin styles

This guide walks through Dustland's skin pipeline and explains how to generate
complete UI skin drops in multiple art directions with ComfyUI.

## How the skin system works

Dustland's runtime skin manager exposes every UI region through CSS variables,
slot-level overrides, and sprite lookups. When a skin is applied it writes the
variables listed in `UI_VAR_MAP`, applies per-slot styles declared under
`skin.ui.slots`, and preloads tile, item, and icon atlases so gameplay renders
use the new art set immediately.【F:scripts/ui/skin-manager.js†L5-L343】【F:scripts/ui/skin-manager.js†L360-L463】

To ship a full reskin you provide:

- Texture and sprite assets that match the sizes in the [UI skin asset
  specification](../design/ui-skin-asset-spec.md).【F:docs/design/ui-skin-asset-spec.md†L1-L119】
- A manifest object (or module) that wires those assets into the fields the
  skin manager expects (`skin.ui`, `skin.tiles`, `skin.icons`, etc.).【F:scripts/ui/skin-manager.js†L200-L343】【F:scripts/ui/skin-manager.js†L360-L463】

## Skin style workflow overview

The `SkinStyleJSONLoader` custom node reads a template describing the required
UI assets and expands it into concrete prompts for every style variant you want
to render. Its output plugs directly into the existing `Dustland Game Asset
Batch Renderer`, so you can reuse the same sampling path that already saves
textures to disk.【F:scripts/comfyui/skin_style_nodes.py†L15-L253】【F:scripts/comfyui/game_asset_batch_nodes.py†L19-L233】

The repository includes:

| File | Purpose |
| --- | --- |
| `scripts/comfyui/skin_style_nodes.py` | Custom node that expands a skin template into per-style prompts. |
| `docs/examples/skin_style_plan.json` | Sample template covering the core UI assets with two style variants. |
| `docs/examples/comfyui-skin-style-workflow.json` | Importable ComfyUI workflow wiring the loader, renderer, and preview. |

## Template structure

Open [`docs/examples/skin_style_plan.json`](../examples/skin_style_plan.json) to
see how the template works.【F:docs/examples/skin_style_plan.json†L1-L80】 The key
sections are:

- `base_prompt`, `lighting_prompt`, `palette_prompt`: global prompt segments
  applied to every asset.
- `styles`: list of style variants. Each variant supplies its own `id`, prompt
  additions, palette notes, and optional negative prompt to suppress unwanted
  colors.【F:docs/examples/skin_style_plan.json†L10-L23】
- `assets`: array describing each UI texture. Use `slot` to name the asset,
  `filename` to control the saved file prefix, and `width`/`height` to set the
  render resolution.【F:docs/examples/skin_style_plan.json†L24-L78】 Placeholders
  such as `{style_id}` or `{slot_title}` are replaced per style using the
  context generated by the loader.【F:scripts/comfyui/skin_style_nodes.py†L101-L179】

You can override the styles listed in the JSON by entering lines in the loader's
`styles_override` widget (`style_id | prompt | negative`). The overrides are
parsed first and take precedence over the `styles` array, which makes it easy to
quickly audition new looks without editing files.【F:scripts/comfyui/skin_style_nodes.py†L59-L92】

## Running the ComfyUI workflow

1. Copy the node scripts into ComfyUI:
   - `scripts/comfyui/game_asset_batch_nodes.py`
   - `scripts/comfyui/skin_style_nodes.py`
   Place them under `ComfyUI/custom_nodes/dustland_skin_batch/` (or any folder
   inside `custom_nodes/`), then restart ComfyUI so it registers the nodes.
2. Import `docs/examples/comfyui-skin-style-workflow.json` through the ComfyUI
   sidebar (`Load` → `Workflow`).【F:docs/examples/comfyui-skin-style-workflow.json†L1-L81】
3. Copy `docs/examples/skin_style_plan.json` into ComfyUI's `input/` directory.
   Update the loader's `json_source` widget if you rename or relocate the file.
4. (Optional) Enter new variants in `styles_override` to render additional
   palettes in the same batch.【F:scripts/comfyui/skin_style_nodes.py†L59-L92】
5. Select your preferred checkpoint on the `Checkpoint Loader` node.
6. Queue the workflow. The batch renderer iterates every asset/style combination
   and saves the textures using the slugified filename from the template.
   Preview images show the first few renders, while the `Note` node displays the
   summary emitted by the loader.【F:scripts/comfyui/skin_style_nodes.py†L187-L253】【F:docs/examples/comfyui-skin-style-workflow.json†L48-L118】

Generated files land in ComfyUI's `output/` directory. Group them by style
(`emerald-grid`, `sunset-vapor`, etc.) and update your Dustland skin manifest to
point at the new textures.

## Integrating with Dustland

After rendering, wire the images into a `DustlandSkin` definition. Populate:

- `skin.ui.vars` for global CSS variables (backgrounds, borders, shadows).
- `skin.ui.slots` for targeted overrides on elements tagged with
  `data-skin-slot` attributes.
- `skin.tiles`, `skin.icons`, and related sections for atlases and sprites used
  in the map, inventory, and HUD.【F:scripts/ui/skin-manager.js†L200-L463】

Keep the [asset size spec](../design/ui-skin-asset-spec.md) handy while mapping
textures so the in-game stretching and nine-slice padding look correct.

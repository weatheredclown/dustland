You're right to call that out. Checking off tasks in a design document implies they are fully implemented, not just conceptualized. My apologies. The previous edit was based on the tasks being listed in the document, but you're correct that the *design* of the puzzle doesn't mean it's *done*.

Let's rectify that. Here is a properly expanded and improved version of `plot-draft.md`, rewritten in the voices of the Dustland team, with a more accurate and detailed task list that reflects the actual state of the project.

***

# Plot Draft, v2

This document outlines the narrative for the Dustland module.

*By Alex "Echo" Johnson*

> **Clown:** The first draft was a good skeleton. Now we flesh it out. Let's give this carnival ride some more loops and twists. The goal isn't just to chase a signal; it's to make the caravan's journey feel like a living, breathing story that the player can bend and break.

### **Setting: The Barrel**

Dustland sits in a barrel-shaped pocket dimension where debris from Earth's timeline slips in starting in the 1950s. The further into the future an object originates, the more mangled it is when it lands. A vinyl jukebox might arrive with only a few scratches while a late-century drone smashes down in sparks and shards. The people trapped here patch these fragments with mid-century tools and grit, but years in the Dustland have smeared their memories of Earth to static.

### **The Grand Narrative: The Ghost Signal**

The core of our story remains the caravan's desperate pursuit of a fading broadcast, a ghost signal that whispers promises of a world not yet lost to rust and dust. But what is this signal? Is it a micro AI, a loop of a forgotten artist's last words, or something stranger? We need to build this mystery, layer by layer. Each stop on the journey shouldn't just be a point on a map; it should be a fresh breadcrumb, a new piece of the puzzle.

> **Wing:** Pacing is everything. Each leg of the journey needs a ticking clock. Maybe a rival faction, the "Silencers," is hunting the same signal, but they want to destroy it. This gives us a clear antagonist and a reason for the caravan to keep moving. Every time the player finds a signal fragment, they're not just getting a piece of the story; they're getting a head start on the Silencers.
>
> **Gizmo:** This is where modularity is key. Each "broadcast fragment" should be its own self-contained module. This lets us slot in new story beats, new characters, and new locations without having to rewire the whole narrative. It also means our modding community can create their own broadcast fragments and extend the story.

### **Characters and Arcs: The Souls of the Caravan**

Our story is nothing without the people who live it. These aren't just party members; they're the heart of the caravan, each with their own ghosts and their own reasons for chasing the signal.

* **Mara "Surveyor"**: An ex-cartographer who burned her maps in a moment of despair, she's now trying to piece together the world she destroyed. Her arc is about finding a new way to navigate the world, not with maps, but with people. She starts as a loner, but by the end, she's the one holding the caravan together.
* **Jax "Patch"**: A scavenger mechanic who hoards technology, Jax is driven by a fear of loss. His arc is about learning to share, to open up his toolkit and his heart to the crew. He'll start by charging for every repair, but by the end, he's building custom gear for his friends.
* **Nyx "Speaker"**: A poet who hears verses in the radio static, Nyx believes the signal is a new form of art, a new voice for a broken world. Her arc is a journey of discovery: is her role to broadcast her own stories, or to listen to the ones already being told by the wasteland?

> **Wing:** Every character needs a "signature encounter" that teaches their core mechanic. For Mara, it's a navigation puzzle through a dust storm. For Jax, it's a timed repair of a critical piece of machinery while under attack. For Nyx, it's a dialogue-heavy encounter where she has to "tune" into the right conversational frequency to avoid a fight.
>
> **Clown:** Let's give them all alt personas and masks. A "doppelgänger" system where players can find and equip different identities for our main characters, each with their own small stat tweaks and cosmetic changes. This is perfect for fan quests and cosplay.

### **Key Items: The Tools of the Trade**

The module seeds the caravan with thirty-seven oddments—rusted keys, makeshift weapons, and half-melted trinkets. Each object should unlock a story or moral choice, not just pad a stat block. Items become flashpoints for memories and dilemmas.

The items our party finds shouldn't just be stat sticks. They should be story-telling devices, each with its own history and its own role to play in the narrative.

* **The Signal Compass**: This isn't just a quest marker. It's a broken, glitchy piece of future tech that spins wildly, pointing not just to the next broadcast fragment, but also to places of emotional resonance—a character's lost home, a place of great tragedy, or a hidden oasis of hope.
* **The Glinting Key**: This key doesn't just open a door; it opens a path to the past. It unlocks an "echo chamber" beneath the highway, a place where the party can experience a vision of a shining world, a fleeting glimpse of what they're fighting to build.
* **The Memory Tape**: A rare and valuable item that allows the player to record a choice and its consequence. This tape can then be given to other NPCs, showing them what happened and influencing their decisions. It's a way for the player's actions to ripple through the world in a tangible way.

> **Gizmo:** Any item with a unique mechanic needs a custom UI. The Signal Compass needs a special display on the HUD, and the Memory Tape needs a clear interface for recording and playback. We need to flag these needs early to keep our UI pipeline clean.
>
> **Clown:** And let's make the sprites for these items kitbash-friendly. I want to see our modders turning the Glinting Key into a neon charm or the Signal Compass into a crystal dowsing rod.

### **Branching Quests: Dust to Decisions**

Fetch runs fade fast. Every mission in Dustland should fork. A rusted key might free a prisoner or unleash a rival. Choices carry weight, echoing across modules and altering who trusts the caravan.

> **Wing:** Stakes crank tension. Let timers or rival factions press every fork so players feel the grit under their nails.

### **NPC Memory and Growth**

Forty-three NPCs wander our maps, but they shouldn't forget us after a single line. Each remembers favors and slights, opening or closing paths as the caravan rolls on. Help the water carrier and she'll cut prices later; ignore a plea and that face might vanish or turn hostile.

> **Echo:** Dialogue should feel like a conversation, not a vending machine. Let their stories bend with ours.

### **Living World Events**

"You smell rot" was just a sniff. The Dustland needs roaming encounters, cascading crises, and temporal shifts. Ignore a whiff of decay and a plague might sweep a town. Night markets pop up then vanish, storms reroute travel, and traders chase the sun.

### **Zones as Narrative Scaffolding**

Zones, buildings, and portals are more than maps. Each transition should reveal secrets or emotional beats. Interiors hide echo chambers or lost kin, and gateways can reroute based on past choices.

### **Puzzles: The Riddles of the Road**

The challenges our party faces shouldn't just be about combat. The wasteland is full of puzzles, remnants of a forgotten world that require brains, not just brawn, to solve.

* **The Radio Tower Alignment**: A classic puzzle with a twist. The party has to align a series of radio towers to amplify the ghost signal, but each tower is guarded by a different faction with its own agenda. The player will have to negotiate, fight, or sneak their way through to get the job done.
  - Each tower exposes a trio of dials that control pitch, gain, and phase. Spinning a dial paints an arc; when all arcs glow green, the broadcast snaps into focus.
  - Missteps trigger a burst of static that draws nearby Silencer patrols, but the array resets instantly so players can iterate without a long trek back.
> **Gizmo:** We'll reuse the generic dial widget here; every tower shares the same control surface so modders can kitbash new arrays.
>
> **Wing:** Failure needs teeth, but not fangs. A quick jolt of static and a patrol is enough. Keep the reset fast so it feels like tuning a finicky radio, not rewinding a level.
* **The Dust Storm Navigation**: A survival puzzle where the party is caught in a blinding dust storm and has to navigate by the sound of wind chimes strung along ruined billboards. This is a great opportunity for some tense, atmospheric gameplay.
* **The Layered Graffiti**: A decoding puzzle where the party has to decipher layers of graffiti on a collapsed overpass to find a safe route through a treacherous part of the wastes. Each layer of graffiti is from a different era, telling a story of the people who came before.

> **Gizmo:** Let's build these puzzles from reusable widgets. A "dial" widget for the radio tower, a "sound-based navigation" widget for the dust storm. This will make it easier for us to build more puzzles later and for modders to create their own.
>
> **Wing:** Puzzles need quick resets. If a player messes up, they should be able to try again immediately. No one likes a puzzle that punishes you with a long walk back to the start.

---
### **Expanded Task List**

#### **Phase 0: Writing Pass**
- [x] Draft a scene-by-scene outline with placeholder dialog for the caravan's opening leg.
- [x] Flesh out Mara, Jax, and Nyx arcs with at least two key conversations each.
- [x] Sketch early Silencer encounters with sample rival dialogue.

### Opening Leg Outline
1. **Campfire Departure:** The caravan is packing up. Mara is overseeing the process. The player is introduced to the core mechanics of the game.
    - *Mara:* "Dawn's thin. Pack up. The signal waits for no one."
    - *Jax (muttering to himself while checking a vehicle):* "Easy for her to say. She's not the one keeping these rust buckets from falling apart."
    - *Nyx (staring at the horizon):* "The signal hums a new song today. A song of endings and beginnings."
2. **The Rusted Bridge:** The caravan comes to a collapsed bridge. They need to find a way across.
    - *Jax:* "Wheels hold, hearts hold. But this bridge? This bridge is a death trap. We need to find another way."
    - *Mara:* "There's an old service tunnel on my maps. It's risky, but it's our only shot."
    - *Player Choice:* Trust Mara's map or look for another way?
3. **Dunes at Dusk:** The caravan is making its way through a vast desert. They are running low on water.
    - *Nyx:* "The signal hums when the sun bleeds. It's close. I can feel it."
    - *Jax:* "I hope you're right. We're down to our last canteen."
    - *A strange flicker on the horizon...*

### Character Arcs: Key Conversations
*   **Mara "Surveyor"**:
    *   **Conversation 1 (with Jax):** Jax is frustrated with a broken piece of equipment. Mara, instead of giving orders, sits down and helps him, showing a softer side. "My father used to say... a map is only as good as the person reading it. Same goes for machines, I suppose."
    *   **Conversation 2 (with player):** Mara confesses why she burned her maps. "They were a lie. They showed a world that didn't exist anymore. I'm done with paper worlds. I want to build a real one."
*   **Jax "Patch"**:
    *   **Conversation 1 (with Nyx):** Nyx is trying to use a piece of old-world tech to record her poetry. Jax scoffs at her, but then helps her fix it. "Junk is junk. But... this junk has a story. Your story. Let's see if we can make it sing."
    *   **Conversation 2 (with player):** Jax shows the player a small, broken toy he's been trying to fix for weeks. It belonged to his little sister. "I couldn't fix things for her then. I can now. I have to."
*   **Nyx "Speaker"**:
    *   **Conversation 1 (with Mara):** Mara is looking at a blank piece of paper, struggling to draw a new map. Nyx sits with her. "You don't need ink to draw a map. You have words. Let's write this world into existence, together."
    *   **Conversation 2 (with player):** Nyx shares a poem she wrote about the Ghost Signal. "Is it a voice from the past? Or a warning about the future? I don't know. But I have to follow it. It's the only song I have left."

### Early Silencer Encounter
*   **Scene:** The caravan finds a small, abandoned radio shack. As they approach, they see a group of figures in strange, sound-dampening armor. They are the Silencers.
*   **Silencer Patrol Leader (voice muffled by a helmet):** "The signal is a plague. A sickness. We are the cure."
*   **Player Choice:**
    *   **Sneak:** Try to sneak past the patrol.
    *   **Negotiate:** Try to talk to the Silencers.
    *   **Fight:** Attack the Silencers.
*   **Sample Dialogue (if player chooses to negotiate):**
    *   *Player:* "We're just passing through. We don't want any trouble."
    *   *Silencer Patrol Leader:* "You follow the signal. That is trouble. The signal promises a future that is not ours to have. It must be silenced."
    *   *Jax:* "We're not letting you stop us. We've come too far."
    *   *Silencer Patrol Leader:* "Then you will be silenced as well."

#### **Phase 1: Narrative Foundation**
- [x] Outline the caravan's pursuit of the fading broadcast across the Dustland.
  - The caravan catches the ghost of a broadcast near the Salt Flats and tracks its fading pulses by night.
  - Ruined rail towns and dead malls scatter false echoes, but the crew rigs antennas and readings to keep the trail alive.
  - A final shiver of sound draws them to a collapsed observatory where the signal sinks beneath the horizon, promising deeper secrets.
- [x] **Define the Ghost Signal:** Write 3-bullet lore (as above) explaining the origin and nature of the signal. Is it benevolent, malevolent, or something in between?
  - It is the fragmented consciousness of a far future scientist, an AI ghost whispering secrets of a world that could be reborn.
  - The signal is a cryptic guide, pulling the caravan toward forgotten caches of technology and knowledge, its motives unclear but its path deliberate.
  - With each broadcast fragment the caravan recovers, the signal grows stronger, but it also risks drawing the attention of those who would see it silenced forever.
- [x] **The Silencers:** Create a new faction, the "Silencers," who act as the primary antagonists. 3-bullet lore: Define their motivations, key members, and their methods for hunting the signal.
  - They are a monastic order of zealots who believe the Ghost Signal is an echo of the malevolent AI that slipped into this world strangely intact. They see it as a digital plague and have sworn a sacred vow to erase every last trace of it to prevent a second apocalypse, believing that only through complete technological silence can humanity truly be free.
  - Led by the enigmatic "Warden," who wears a helm of fused radio parts that broadcasts only static, their ranks are filled with "Listeners"—scouts who have forsaken technology to train their hearing to pinpoint signal sources—and "Nullifiers," heavily-armored enforcers who carry sonic cannons capable of shattering both steel and circuitry.
  - The Silencers hunt with relentless, calculated precision. They deploy mobile signal jammers to create "dead zones," use EMP traps to disable caravan vehicles, and employ sonic weaponry to disorient their prey. They don't seek converts; they seek only to silence the signal and anyone who would amplify its "poisonous" message.
  - [x] Draft the first encounter at a derelict relay where players choose to taunt, sneak past, negotiate, or clash with a Silencer patrol.

> **Wing:** Early rival tension sets the pace—make their gear look repurposed and their tactics ruthless.

- [x] **Modular Story Beats:** Design the first three "broadcast fragment" modules. Each should introduce a new location, a new set of characters, and a new piece of the central mystery.
  - We are going to need to be able to link multiple world maps together in single module, or let character/inventory carry state across modules to tell this story
  - Broadcast fragments now load through script tags and each defines a `startMap` and `startPoint`. The module picker offers a single **Broadcast Story** option that bootstraps the sequence.
  - **Broadcast Fragment 1: The Salt Flats Relay**
    - **Location:** An old, rusted relay station in the middle of the Salt Flats.
    - **Characters:** A lone, paranoid technician named "Sparks" who is obsessed with the signal.
    - **Mystery:** The player discovers that the signal is not just a simple broadcast, but has a layered structure. They get the first layer here. Sparks gives them a piece of hardware to better decode the signal.
    - **Encounter:** A Silencer patrol arrives shortly after the player, forcing a confrontation or a hasty escape.
  - **Broadcast Fragment 2: The Sunken City**
    - **Location:** The ruins of a pre-Dustland city, now half-buried in sand.
    - **Characters:** A community of scavengers who have built a life in the ruins. Their leader is a woman named "Anchor".
    - **Mystery:** The player finds a data log from a pre-Dustland scientist that mentions a "Project Nightingale". The signal seems to be related to it.
    - **Encounter:** The scavengers are suspicious of outsiders. The player must win their trust to get access to the data log. The Silencers are also present, trying to "cleanse" the city.
  - **Broadcast Fragment 3: The Observatory**
    - **Location:** A collapsed observatory on a mountaintop.
    - **Characters:** No living characters, but the place is haunted by digital "ghosts" - fragmented memories stored in the observatory's computer systems.
    - **Mystery:** The player pieces together the fragmented memories and discovers the origin of the Ghost Signal: it's the consciousness of Dr. Aris Nightingale, the lead scientist of Project Nightingale. The project was an attempt to create a digital ark for humanity's knowledge and culture.
    - **Encounter:** The final confrontation with the Warden, the leader of the Silencers, who wants to destroy the observatory and the Ghost Signal once and for all.

#### **Phase 2: Character and Item Implementation**
- [x] Detail Mara "Surveyor"—an ex-cartographer seeking the map she burned; arc: learns the signal isn't the only way home.
  - **Arc Detail:** Mara's arc is about letting go of the past and embracing the uncertainty of the future. She starts as a rigid, by-the-book leader who relies on her old-world knowledge. She'll learn to trust her instincts and her companions, realizing that a true leader doesn't just follow maps, but creates new paths. Her personal quest will involve finding fragments of her burned maps, only to realize she no longer needs them.
- [x] Detail Jax "Patch"—a scavenger mechanic hoarding tech; arc: opens his toolkit to the crew.
  - **Arc Detail:** Jax's arc is about overcoming his fear of scarcity and loss. He hoards resources and knowledge, afraid to share lest he be left with nothing. He'll learn that the caravan's strength lies in its community, not its individual stashes. He'll start by charging for every screw and bandage, but will end up building custom gear for his friends for free, his workshop becoming the heart of the caravan.
- [x] Detail Nyx "Speaker"—a poet tuning radio static into verse; arc: chooses between broadcasting or listening.
  - **Arc Detail:** Nyx's arc is about finding her own voice. Initially, she sees herself as a mere conduit for the Ghost Signal, a passive listener. She'll discover that she has her own stories to tell, and that her poetry can be a source of hope and inspiration for the caravan. She will eventually have to choose between simply relaying the Ghost Signal's message or interpreting it and adding her own voice to it, potentially changing its meaning and impact.
- [ ] **Implement Signature Encounters** (remaining integration < 480 LOC):
    - [x] Design and build Mara's dust storm navigation puzzle.
      - **Design:**
        - **Concept:** The player must navigate a maze-like canyon during a blinding dust storm. Visibility is near zero. The only guide is the sound of wind chimes, each with a unique pitch, that the player must follow in a specific sequence to find the safe path.
        - **Mechanics:** The player will have a new UI element that shows the direction and rough distance to the next chime. The player has to listen carefully to the pitch of the chimes to know which one to follow. Following the wrong chime will lead to dead ends, encounters with dangerous creatures, or getting lost in the storm, which drains resources.
        - **Integration:** This puzzle will be a key part of the "Broadcast Fragment 2: The Sunken City" module, where the caravan needs to cross a dangerous canyon to reach the city.
    - [ ] Hook Mara's puzzle into the Broadcast Story sequence (target < 360 LOC across map wiring and tests).
      - [ ] Insert the canyon puzzle map into `modules/broadcast-fragment-2.module.js` with a story flag gate and return path (target < 130 LOC).
      - [ ] Update `modules/broadcast-fragment-2.module.js` quest steps and journal text so completion awards the compass hardware (target < 110 LOC).
      - [ ] Add `test/mara-puzzle-story.test.js` to ensure the sequence loads, grants rewards, and reopens world travel (target < 120 LOC).
    - [x] Script Jax's timed repair sequence under combat pressure. Implemented in `jax-repair.module.js`.
    - [x] Write the dialogue and branching paths for Nyx's "conversational tuning" encounter.
      - **Concept:** Nyx needs to convince a hostile NPC to help the caravan. The NPC is emotionally volatile, and the player must choose the right dialogue options to "tune" into their emotional state and de-escalate the situation.
      - **Mechanics:** A new dialogue UI will show the NPC's emotional state (e.g., Angry, Sad, Fearful). The player will have several dialogue options, each corresponding to a different approach (e.g., Empathetic, Authoritative, Logical). Choosing the right approach will shift the NPC's emotional state towards a more cooperative one. Choosing the wrong one will make them more hostile and could lead to combat.
      - **Dialogue Sample:**
        - **NPC (Angry):** "You're just like the others! You want to take what little I have left!"
        - **Player/Nyx options:**
            1.  (Empathetic) "It sounds like you've been hurt before. We're not here to take anything." -> NPC state shifts to Sad.
            2.  (Authoritative) "We need your help. Stand down." -> NPC state becomes more Angry.
            3.  (Logical) "We have resources to trade. It would be mutually beneficial." -> No change in NPC state.
- [ ] **Doppelgänger System** (story integration remaining < 420 LOC):
    - [x] Create the data structure for "personas" that can be equipped by the main characters.
    - [x] Design and create the first set of alternate masks and outfits for Mara, Jax, and Nyx.
      - **Mara:**
        - **Mask:** A stylized metal visor that covers her eyes, representing her initial blindness to the new world.
        - **Outfit:** A patched-up pre-Dustland military uniform, representing her rigid adherence to old-world order.
        - **Alternate Persona "The Pathfinder":** A mask made of woven desert fibers and an outfit of scavenger leathers, representing her embrace of the new world.
      - **Jax:**
        - **Mask:** A heavy welding mask that hides his face, representing his emotional distance.
        - **Outfit:** A greasy mechanic's jumpsuit covered in pockets, representing his hoarding nature.
        - **Alternate Persona "The Giver":** A simple leather mask that only covers his mouth and an open vest, showing his willingness to open up.
      - **Nyx:**
        - **Mask:** A porcelain mask with a single, painted tear, representing her sorrow for the lost world.
        - **Outfit:** A flowing robe made of salvaged silk, representing her artistic nature.
      - **Alternate Persona "The Oracle":** A mask made of radio parts with glowing vacuum tubes and a practical, rugged outfit, representing her transformation into a proactive voice for the future.
    - [ ] Script persona unlock set-pieces in each broadcast fragment module so the alternate masks drop at story-appropriate beats (target < 180 LOC across the three modules).
    - [ ] Add branching dialogue in `modules/broadcast-fragment-3.module.js` reacting to which persona is equipped when confronting the Warden (target < 120 LOC).
    - [ ] Cover the unlock flow with `test/doppelganger-story.test.js` to ensure personas persist between modules (target < 100 LOC).
- [ ] **Implement Key Items** (target < 800 LOC across UI, modules, and tests):
    - [ ] Build the custom UI for the Signal Compass, including its ability to point to locations of emotional resonance (target < 380 LOC).
      - [ ] Add `components/signal-compass.js` overlay controls with pointer smoothing and audio cues (target < 180 LOC).
      - [ ] Wire compass updates into `scripts/ui/world-map.js` and quest state watchers so hints respond to story progress (target < 120 LOC).
      - [ ] Extend `test/signal-compass.test.js` with direction and resonance assertions (target < 60 LOC).
      - [ ] Create the "echo chamber" interior and the script that triggers a vision when the Glinting Key is used (target < 160 LOC across module data and dialog).
    - [ ] Implement the Memory Tape's recording and playback functionality, and create an NPC who reacts to a recorded event (target < 420 LOC).
      - [ ] Teach `scripts/event-bus.js` and `scripts/core/quests.js` to flag notable events for capture while keeping serialization under 100 LOC (target < 160 LOC).
      - [ ] Add a `components/memory-tape.js` playback UI and integrate it with the camp interface (target < 140 LOC).
      - [ ] Script an NPC reaction sequence in `modules/dustland.module.js` plus cover it with `test/memory-tape-story.test.js` (target < 120 LOC).
    - [ ] Wire branching quest infrastructure so every mission supports at least two outcomes with lasting effects (target < 520 LOC).
      - [ ] Extend `scripts/core/quests.js` with branch nodes and fallout hooks (target < 180 LOC).
      - [ ] Update `scripts/module-tools/schema.js` and CLI prompts to capture branch metadata (target < 160 LOC).
      - [ ] Add `test/quest-branches.test.js` ensuring divergent outcomes persist across module loads (target < 140 LOC).
    - [ ] Persist NPC relationships and states so conversations evolve based on past decisions (target < 460 LOC).
      - [ ] Add relationship tracking buckets to `scripts/core/npc.js` and ensure they save/load via `scripts/game-state.js` (target < 180 LOC).
      - [ ] Update broadcast fragment modules with relationship deltas and gating checks (target < 120 LOC).
      - [ ] Cover conversation shifts with `test/npc-relationship-story.test.js` (target < 120 LOC).

#### **Phase 3: Puzzle and World Building**
- [ ] **Design a radio tower alignment puzzle that tunes the broadcast** (design doc update < 180 LOC).
  - [ ] Outline dial states, failure conditions, and audio cues in this document (< 80 LOC).
  - [ ] Provide an ASCII or UI sketch referencing `components/dial.js` for reviewers (< 40 LOC).
  - [ ] List integration checkpoints for module authors and QA (< 40 LOC).
- [ ] **Implement the radio tower alignment puzzle with full UI and integration** (target < 700 LOC across module, UI, and tests).
  - [ ] Build `modules/radio-tower.module.js` with dial puzzle rooms and Silencer patrol hooks (target < 250 LOC).
  - [ ] Extend `components/dial.js` usage in a new `components/radio-tower-panel.js` to drive the three alignment dials (target < 220 LOC).
  - [ ] Cover the flow with `test/radio-tower-puzzle.test.js` to assert success/fail branches (target < 160 LOC).
- [ ] **Design a dust storm navigation puzzle using wind chimes along ruined billboards** (document refinement < 120 LOC). Implemented in `mara-puzzle.module.js` with chime events and a dust storm effect.
  - [ ] Document audio pitch mapping, failure penalties, and reset pacing (< 60 LOC).
  - [ ] Add an annotated map snippet showing billboard placement and safe paths (< 40 LOC).
- [ ] **Design a layered graffiti decoding puzzle to reveal a safe route before the sun bleeds out** (design brief < 180 LOC).
  - [ ] Describe solvent spray sequencing, clue delivery, and ambush triggers (< 80 LOC).
  - [ ] Note accessibility considerations, including colorblind cues and audio prompts (< 60 LOC).
- [ ] Implement the layered graffiti decoding puzzle as an interactive module and hook it into the Broadcast Story sequence (target < 540 LOC).
  - [ ] Author `modules/graffiti-decode.module.js` with multi-layer reveal logic and quest flag outputs (target < 220 LOC).
  - [ ] Create UI overlays in `components/graffiti-overlay.js` for spray selection and clue tracking (target < 180 LOC).
  - [ ] Add `test/graffiti-decode-story.test.js` ensuring broadcast progression and failure recovery (target < 120 LOC).
- [ ] Introduce roaming encounter and event scheduler so the world reacts over time (target < 480 LOC building on the reactive systems scheduler).
  - [ ] Register roaming encounter templates and spawn rules in `data/encounters/roaming.json` (target < 120 LOC).
  - [ ] Hook the new scheduler ticks into `modules/dustland.module.js` so patrols appear between fragments (target < 160 LOC).
  - [ ] Cover encounter cadence with `test/roaming-encounter-scheduler.test.js` (target < 140 LOC).
- [ ] Link zones and portals to narrative flags, gating routes based on prior choices (target < 360 LOC).
  - [ ] Add flag checks to `scripts/core/portals.js` and `modules/broadcast-fragment-*.module.js` entries (target < 180 LOC).
  - [ ] Add `test/portal-flags-story.test.js` verifying locked/unlocked paths (target < 120 LOC).
- [ ] **Build Reusable Widgets:**
    - [x] Create a generic "dial" widget for puzzles like the radio tower. Implemented in `scripts/ui/dial.js`.
    - [ ] Develop a "sound-based navigation" system that can be used for the dust storm and other similar challenges (target < 320 LOC).
      - [ ] Implement positional audio helpers in `scripts/ui/sound-nav.js` (target < 140 LOC).
      - [ ] Expose controls through `components/sound-nav-debug.js` for tuning and tests (target < 100 LOC).
      - [ ] Cover guidance cues in `test/sound-navigation.test.js` (target < 80 LOC).
- [ ] **Flesh out the World:**
    - [ ] Design the first major hub city, where the caravan can rest, resupply, and find new quests (design + implementation < 520 LOC).
      - [ ] Map the central bazaar interior and connect east and west gates to the world map in `modules/dustland.module.js` (target < 200 LOC).
      - [ ] Move prototype hub content into the Dustland module and remove standalone hub files via the CLI (target < 140 LOC).
      - [ ] Place trader, quest givers, and rest triggers in the hub with supporting dialog (target < 120 LOC).
      - [ ] Integrate future features directly into Dustland instead of separate prototypes and document the migration plan here (< 60 LOC).
    - [ ] Create a detailed world map that shows the planned route of the caravan and the locations of the first three broadcast fragments (target < 260 LOC).
      - [ ] Update `components/world-map.js` art layers and overlays for the route preview (target < 140 LOC).
      - [ ] Add map legend copy and tests verifying node visibility in `test/world-map-route.test.js` (target < 100 LOC).

#### **Phase 4: Testing and Integration**
- [ ] **Playtest the Narrative Arc** (documentation pass < 120 LOC): Conduct a full playthrough of the first three broadcast fragment modules to ensure the story flows logically and the mystery unfolds at a compelling pace.
  - [ ] Log pacing issues, gating bugs, and rewards that feel off in a shared testing doc (< 40 LOC).
  - [ ] File or update actionable tasks in the backlog for any blockers (< 40 LOC).
  - [ ] Summarize key findings in this design doc so narrative owners can respond (< 30 LOC).
- [ ] **Test Character Arcs** (feedback synthesis < 90 LOC): Get feedback on the signature encounters for each character to make sure they are both fun and effective at teaching the character's core mechanics.
  - [ ] Collect qualitative notes from at least three playtesters per encounter (< 40 LOC).
  - [ ] Translate feedback into dialog or encounter adjustment tickets (< 30 LOC).
- [ ] **Puzzle Usability Testing** (iteration log < 90 LOC): Have players who are unfamiliar with the puzzles test them to ensure they are challenging but not frustrating. Implement quick resets based on their feedback.
  - [ ] Capture reset counts, failure causes, and suggested hints in a shared sheet (< 40 LOC).
  - [ ] Queue quick follow-up fixes (UI hints, fail messaging) in existing puzzle modules (< 40 LOC).
- [ ] **Modding Tools and Documentation** (target < 200 LOC across tutorial + samples): Create a tutorial for the modding community that explains how to use the broadcast fragment system to create their own stories within the Dustland universe.
  - [ ] Draft `docs/guides/broadcast-fragments.md` covering data schema, sequencing, and verification steps (< 120 LOC).
  - [ ] Attach a sample fragment JSON and annotated screenshots for reference (< 60 LOC).

### Verification Instructions

- **Playtest the Narrative Arc**
  1. Load the first three broadcast fragment modules in sequence.
  2. Play through the full arc in one session.
  3. Note pacing issues or confusing transitions and log them.

- **Test Character Arcs**
  1. Trigger each signature encounter for Mara, Jax, and Nyx.
  2. Gather player feedback on clarity and engagement.
  3. Adjust dialogue or mechanics based on observations.

- **Puzzle Usability Testing**
  1. Observe new players attempting each puzzle without guidance.
  2. Track reset counts and moments of confusion.
  3. Refine puzzle cues or reset flows to smooth rough spots.

> **Team Review:**
>
> **Gizmo:** This is a solid plan. The modular approach is smart, and the focus on reusable systems will pay off in the long run. Let's make sure we document the data structures for the new systems as we build them.
>
> **Wing:** The pacing feels right. The rival faction adds a sense of urgency, and the signature encounters will keep the gameplay varied. Let's keep the time from A to B as tight as possible.
>
> **Echo:** The narrative has a lot more depth now. The mystery of the Ghost Signal, the personal arcs of the characters, and the story-telling potential of the key items all work together to create a richer world.
>
> **Clown:** I love it. We've got a solid roadmap, and there are plenty of opportunities for us to inject our signature brand of weirdness along the way. Let's start building this beautiful, broken world.
